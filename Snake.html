<head>
	<script>
		//Defining sprite and display objects
		window.onload = function () {
		    game();
		};
		var canvasCount=0;
		var spriteSz=8;
		let palette={
			r: "rgba(255,0,0,255)",
			g: "rgba(0,255,0,255)",
			b: "rgba(0,0,255,255)",
			c: "rgba(0,255,255,255)",
			n: "rgba(0,0,0,255)",
			w: "rgba(255,255,255,255)",
			" ": "rgba(0,0,0,255)"
		}

		function modulo(a, b) {
		  return ((a % b) + b) % b
		}

		function toSprite(spriteStr){
			var sprite=[];
			for (var y=0;y<spriteSz;y++){
				sprite.push([]);
				for (var x=0;x<spriteSz;x++){
					sprite[y].push(palette[spriteStr[(y*spriteSz+x)]]);
				}
			}
			return sprite;
		}

		let t={
			flip:1,
			rotate:2,
			left:1,
			right:2,
			flipped:3,
			vertical:1,
			horizontal:2
		}

		function transform(sprite,type,arg){
			if (type==t.flip){
				if (arg==t.vertical){
					sprite.reverse();
				}
				else if (arg==t.horizontal){
					for (let row=0;row<spriteSz;row++){
						sprite[row].reverse();
					}
				}
				return sprite;
			}
			else if (type=t.rotate){
				let rotated=[];
				if (arg==t.left){
					for (var y=0;y<spriteSz;y++){
						rotated.push([]);
						for (var x=0;x<spriteSz;x++){
							rotated[y].push(sprite[x][spriteSz-y-1]);
						}
					}
				}
				else if (arg==t.right){
					for (var y=0;y<spriteSz;y++){
						rotated.push([]);
						for (var x=0;x<spriteSz;x++){
							rotated[y].push(sprite[spriteSz-x-1][y]);
						}
					}
				}
				else if (arg==t.flipped){
					return transform(transform(sprite,t.flip,t.horizontal),t.flip,t.vertical);
				}
				return rotated;
			}
		}

		let sprites={
			empty : toSprite(
			        	"        "+
			        	"        "+
			        	"        "+
			        	"        "+
			        	"        "+
			        	"        "+
			        	"        "+
			        	"        "
				    ),
			body  : toSprite(
			        	"        "+
			        	"        "+
			        	"rccccccc"+
			        	"rccccccc"+
			        	"ccccrccc"+
			        	"ccccrccc"+
			        	"        "+
			        	"        "
				    ),
			corner  : toSprite(
			        	"        "+
			        	"        "+
			        	"rccccc  "+
			        	"rccccc  "+
			        	"ccccrr  "+
			        	"cccccc  "+
			        	"  cccc  "+
			        	"  cccc  "
				    ),
			food    : toSprite(
			        	"        "+
			        	" ggrrrr "+
			        	" ggrrrr "+
			        	" gggrrr "+
			        	"  ggrrr "+
			        	"  ggggr "+
			        	"    ggg "+
			        	"        "
			        ),
			head    : toSprite(
			        	"        "+
			        	"    cccc"+
			        	"rcccc  c"+
			        	"rccccccc"+
			        	"ccccrccr"+
			        	"ccccrccc"+
			        	"        "+
			        	"        "
			        ),
			tail : toSprite(
			        	"        "+
			        	"        "+
			        	"      cc"+
			        	"    cccc"+
			        	"  cccrcc"+
			        	" ccccrcc"+
			        	"        "+
			        	"        "
				    )
		}

		function square(color,x,y,size,ctx){
			ctx.fillStyle = color;
			ctx.fillRect( x, y, size, size );
		}

		function pixel(color,x,y,size,ctx){
			square(color,x*size,y*size,size,ctx);
		}

		class Canvas{
			constructor(width,height,scale,within){
				this.canvasArea=canvasArea;
				this.id=canvasCount;
				canvasArea.innerHTML='<canvas height="'+ height*spriteSz*scale +'" width="'+ width*spriteSz*scale +'" id="'+this.id+'" class="gameCanvas">Ur browser kinda L tho</canvas>\n';
				canvasCount+=1;
				this.height=height;
				this.width=width;
				this.canvas=document.getElementById(this.id);
				this.ctx=this.canvas.getContext('2d');
				this.scale=scale;
			}

			setSpixel(color,sx,sy,x,y){
				pixel(color,sx*spriteSz+x,sy*spriteSz+y,this.scale,this.ctx);
			}

			setSprite(sprite,sx,sy){
				for (var y=0;y<spriteSz;y++){
					for (var x=0;x<spriteSz;x++){
						this.setSpixel(sprite[y][x],sx,sy,x,y);
					}
				}
			}

			fillSprite(sprite){
				for (var y=0;y<this.height;y++){
					for (var x=0;x<this.width;x++){
						this.setSprite(sprite,x,y);
					}
				}
			}
		}

		let keys={
			up:    38,
			down:  40,
			left:  37,
			right: 39,
			pause: 32 
		}

		//The actual game?
		var screen=undefined;
		function game(){
			let canvasArea=document.getElementById("canvasArea");
			canvasArea.innerHTML=" ";
			screen=new Canvas(23,23,2,canvasArea);
			screen.fillSprite(sprites.empty);

			let x=0;
			let y=0;
			screen.setSprite(sprites.tail,0,0);
			screen.setSprite(sprites.body,1,0);
			screen.setSprite(sprites.head,2,0);
			screen.setSprite(sprites.food,1,1);
			// screen.setSprite(sprites.food,0,0);

			function move(nx,ny){
				screen.setSprite(sprites.empty,x,y)
				x=modulo(nx,screen.width);
				y=modulo(ny,screen.height);
				screen.setSprite(sprites.food,x,y)
			}

			document.addEventListener('keydown', function(event) {
				if(event.keyCode == keys.up) {
					move(x,y-1);
				}
				else if(event.keyCode == keys.down) {
					move(x,y+1);
				}
				else if(event.keyCode == keys.left) {
					move(x-1,y);
				}
				else if(event.keyCode == keys.right) {
					move(x+1,y);
				}
			});
		}
	</script>

	<style>
		body {
			background-color: black;
			color: white;
		}
		.center {
			text-align: center;
		}
		.gameCanvas {
			outline: white 3px dotted;
		}
	</style>
</head>

<body>
	<div id="gameArea" class="center">
		<h1>Snake!</h1>
		<div id="canvasArea">
		</div>
	</div>
</body>